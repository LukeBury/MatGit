function [A] = get_Amat_CR3BP_J2pJ4pJ6pJ2s(prms, r_n)
%%% Description
%       Returns the A-matrix for the modified CR3BP which accounts for J2,
%       J4, and J6 of the primary, as well as J2 of the secondary
%       
% --------------------------------------------------------------
%%% Inputs
%       prms - (u, R1, R2, J2p, J2s, J3p, J3s, J4p, J4s)
%       r_n - [3x1] Normalized position vector to evaluate dynamics at
% --------------------------------------------------------------
%%% Outputs
%       A - [6x6] A matrix for the classical CR3BP (Jacobian of state wrt dynamics)
% --------------------------------------------------------------
%%% Author
%       Luke Bury, luke.bury@colorado.edu
% ===============================================================
% ------------------------------------
%%% Unpack position
% ------------------------------------
%%% Enforcing column vector
r_n = r_n(:);

%%% Unpacking
x_n = r_n(1);
y_n = r_n(2);
z_n = r_n(3);

% ------------------------------------
%%% Calculate A Matrix
% ------------------------------------
% %%% Full A matrix
% Amat = @(u, x, y, z) ...
%     [zeros(3,3),     eye(3);...
%      A_LL(u,x,y,z), [0,2,0;-2,0,0;0,0,0]];

A = zeros(6,6);
A(1:3,4:6) = eye(3);
A(4,5) = 2;
A(5,4) = -2;

A(4,1) = (prms.u - 1)/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(3/2) - prms.u/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(3/2) + (3*prms.u*(2*prms.u + 2*x_n - 2)^2)/(4*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2)) - (3*(2*prms.u + 2*x_n)^2*(prms.u - 1))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2)) - (prms.J2p*prms.R1^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) + (prms.J2s*prms.R2^2*prms.u)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (5*prms.J2s*prms.R2^2*prms.u*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) - (9*prms.J4p*prms.R1^4*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (5*prms.J2s*prms.R2^2*prms.u*(2*prms.u + 2*x_n - 2)^2)/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) + (5*prms.J2p*prms.R1^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) - (prms.J6p*prms.R1^6*(prms.u - 1)*(30*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 30*(2*prms.u + 2*x_n)^2*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 210*z_n^2*(2*prms.u + 2*x_n)^2 + 630*z_n^4 - 420*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (13*prms.J6p*prms.R1^6*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (5*prms.J2p*prms.R1^2*(2*prms.u + 2*x_n)^2*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) + (prms.J4p*prms.R1^4*(prms.u - 1)*(6*(2*prms.u + 2*x_n)^2 + 12*(prms.u + x_n)^2 + 12*y_n^2 - 48*z_n^2))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (195*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)^2*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(64*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) - (9*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)*(6*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 30*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (35*prms.J2s*prms.R2^2*prms.u*(2*prms.u + 2*x_n - 2)^2*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(8*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (13*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)*(prms.u - 1)*(315*z_n^4*(2*prms.u + 2*x_n) + 15*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 210*z_n^2*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (99*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)^2*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*(2*prms.u + 2*x_n)^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) + 1; % dx_ndd/dx_n
A(4,2) = (3*prms.u*y_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2)) - (3*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2)) - (prms.J6p*prms.R1^6*(60*y_n*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 420*y_n*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (5*prms.J2s*prms.R2^2*prms.u*y_n*(2*prms.u + 2*x_n - 2))/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) - (9*prms.J4p*prms.R1^4*y_n*(6*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 30*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (13*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)*(prms.u - 1)*(630*y_n*z_n^4 + 30*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 420*y_n*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (5*prms.J2p*prms.R1^2*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) + (3*prms.J4p*prms.R1^4*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) + (13*prms.J6p*prms.R1^6*y_n*(prms.u - 1)*(315*z_n^4*(2*prms.u + 2*x_n) + 15*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 210*z_n^2*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (9*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)*(12*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 60*y_n*z_n^2)*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (195*prms.J6p*prms.R1^6*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*y_n*(2*prms.u + 2*x_n - 2)*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (99*prms.J4p*prms.R1^4*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)); % dx_ndd/dy_n
A(4,3) = (3*prms.u*z_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2)) - (3*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2)) - (prms.J6p*prms.R1^6*(840*z_n^3*(2*prms.u + 2*x_n) - 360*z_n*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (5*prms.J2s*prms.R2^2*prms.u*z_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) + (9*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)*(48*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 80*z_n^3)*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (9*prms.J4p*prms.R1^4*z_n*(6*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 30*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (5*prms.J2p*prms.R1^2*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) - (6*prms.J4p*prms.R1^4*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2) - (13*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)*(prms.u - 1)*(756*z_n^5 + 180*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*z_n^3*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (13*prms.J6p*prms.R1^6*z_n*(prms.u - 1)*(315*z_n^4*(2*prms.u + 2*x_n) + 15*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 210*z_n^2*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (195*prms.J6p*prms.R1^6*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*z_n*(2*prms.u + 2*x_n - 2)*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (99*prms.J4p*prms.R1^4*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)); % dx_ndd/dz_n
A(5,1) = (3*prms.u*y_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2)) - (3*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2)) - (prms.J6p*prms.R1^6*(60*y_n*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 420*y_n*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (5*prms.J2s*prms.R2^2*prms.u*y_n*(2*prms.u + 2*x_n - 2))/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) - (9*prms.J4p*prms.R1^4*y_n*(6*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 30*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (13*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)*(prms.u - 1)*(630*y_n*z_n^4 + 30*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 420*y_n*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (5*prms.J2p*prms.R1^2*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) + (3*prms.J4p*prms.R1^4*y_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) + (13*prms.J6p*prms.R1^6*y_n*(prms.u - 1)*(315*z_n^4*(2*prms.u + 2*x_n) + 15*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 210*z_n^2*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (9*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)*(12*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 60*y_n*z_n^2)*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (195*prms.J6p*prms.R1^6*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*y_n*(2*prms.u + 2*x_n - 2)*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (99*prms.J4p*prms.R1^4*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*y_n*(2*prms.u + 2*x_n)*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)); % dy_ndd/dx_n
A(5,2) = (prms.u - 1)/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(3/2) - prms.u/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(3/2) - (3*y_n^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) + (3*prms.u*y_n^2)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (prms.J2p*prms.R1^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) + (prms.J2s*prms.R2^2*prms.u)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (5*prms.J2s*prms.R2^2*prms.u*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) + (10*prms.J2p*prms.R1^2*y_n^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) + (prms.J4p*prms.R1^4*(prms.u - 1)*(12*(prms.u + x_n)^2 + 36*y_n^2 - 48*z_n^2))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (9*prms.J4p*prms.R1^4*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (prms.J6p*prms.R1^6*(prms.u - 1)*(30*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*y_n^2*z_n^2 + 630*z_n^4 + 120*y_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 420*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (5*prms.J2p*prms.R1^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) + (13*prms.J6p*prms.R1^6*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (10*prms.J2s*prms.R2^2*prms.u*y_n^2)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) + (99*prms.J4p*prms.R1^4*y_n^2*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (13*prms.J6p*prms.R1^6*y_n*(prms.u - 1)*(630*y_n*z_n^4 + 30*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 420*y_n*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (35*prms.J2p*prms.R1^2*y_n^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (9*prms.J4p*prms.R1^4*y_n*(12*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 60*y_n*z_n^2)*(prms.u - 1))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (195*prms.J6p*prms.R1^6*y_n^2*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*y_n^2*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + 1; % dy_ndd/dy_n
A(5,3) = (3*prms.u*y_n*z_n)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (3*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) - (prms.J6p*prms.R1^6*(1680*y_n*z_n^3 - 720*y_n*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (13*prms.J6p*prms.R1^6*z_n*(prms.u - 1)*(630*y_n*z_n^4 + 30*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 420*y_n*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (5*prms.J2p*prms.R1^2*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) - (12*prms.J4p*prms.R1^4*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2) - (13*prms.J6p*prms.R1^6*y_n*(prms.u - 1)*(756*z_n^5 + 180*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*z_n^3*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (9*prms.J4p*prms.R1^4*z_n*(12*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 60*y_n*z_n^2)*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (5*prms.J2s*prms.R2^2*prms.u*y_n*z_n)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) + (9*prms.J4p*prms.R1^4*y_n*(48*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 80*z_n^3)*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (99*prms.J4p*prms.R1^4*y_n*z_n*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*y_n*z_n*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (195*prms.J6p*prms.R1^6*y_n*z_n*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*y_n*z_n*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)); % dy_ndd/dz_n
A(6,1) = (3*prms.u*z_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2)) - (3*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2)) - (prms.J6p*prms.R1^6*(840*z_n^3*(2*prms.u + 2*x_n) - 360*z_n*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (5*prms.J2s*prms.R2^2*prms.u*z_n*(2*prms.u + 2*x_n - 2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) + (9*prms.J4p*prms.R1^4*(2*prms.u + 2*x_n)*(48*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 80*z_n^3)*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (9*prms.J4p*prms.R1^4*z_n*(6*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 30*z_n^2*(2*prms.u + 2*x_n))*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) - (5*prms.J2p*prms.R1^2*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) - (6*prms.J4p*prms.R1^4*z_n*(2*prms.u + 2*x_n)*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2) - (13*prms.J6p*prms.R1^6*(2*prms.u + 2*x_n)*(prms.u - 1)*(756*z_n^5 + 180*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*z_n^3*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (13*prms.J6p*prms.R1^6*z_n*(prms.u - 1)*(315*z_n^4*(2*prms.u + 2*x_n) + 15*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 210*z_n^2*(2*prms.u + 2*x_n)*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (195*prms.J6p*prms.R1^6*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(32*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*z_n*(2*prms.u + 2*x_n - 2)*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (99*prms.J4p*prms.R1^4*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*z_n*(2*prms.u + 2*x_n)*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)); % dz_ndd/dx_n
A(6,2) = (3*prms.u*y_n*z_n)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (3*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) - (prms.J6p*prms.R1^6*(1680*y_n*z_n^3 - 720*y_n*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2))*(prms.u - 1))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (13*prms.J6p*prms.R1^6*z_n*(prms.u - 1)*(630*y_n*z_n^4 + 30*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 420*y_n*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (5*prms.J2p*prms.R1^2*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) - (12*prms.J4p*prms.R1^4*y_n*z_n*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2) - (13*prms.J6p*prms.R1^6*y_n*(prms.u - 1)*(756*z_n^5 + 180*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*z_n^3*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (9*prms.J4p*prms.R1^4*z_n*(12*y_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 60*y_n*z_n^2)*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (5*prms.J2s*prms.R2^2*prms.u*y_n*z_n)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) + (9*prms.J4p*prms.R1^4*y_n*(48*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 80*z_n^3)*(prms.u - 1))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (99*prms.J4p*prms.R1^4*y_n*z_n*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*y_n*z_n*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (195*prms.J6p*prms.R1^6*y_n*z_n*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*y_n*z_n*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)); % dz_ndd/dy_n
A(6,3) = (prms.u - 1)/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(3/2) - prms.u/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(3/2) - (3*z_n^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) + (3*prms.u*z_n^2)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) + (2*prms.J2p*prms.R1^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(5/2) - (2*prms.J2s*prms.R2^2*prms.u)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(5/2) - (5*prms.J2s*prms.R2^2*prms.u*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2)) - (20*prms.J2p*prms.R1^2*z_n^2*(prms.u - 1))/((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2) - (prms.J4p*prms.R1^4*(prms.u - 1)*(48*(prms.u + x_n)^2 + 48*y_n^2 - 96*z_n^2))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (9*prms.J4p*prms.R1^4*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)) + (prms.J6p*prms.R1^6*(prms.u - 1)*(180*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 2100*z_n^4 - 1800*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) + (5*prms.J2p*prms.R1^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(7/2)) + (13*prms.J6p*prms.R1^6*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) + (20*prms.J2s*prms.R2^2*prms.u*z_n^2)/((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(7/2) + (99*prms.J4p*prms.R1^4*z_n^2*(prms.u - 1)*(3*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 + 35*z_n^4 - 30*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(13/2)) - (35*prms.J2p*prms.R1^2*z_n^2*(prms.u - 1)*((prms.u + x_n)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(9/2)) - (13*prms.J6p*prms.R1^6*z_n*(prms.u - 1)*(756*z_n^5 + 180*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 840*z_n^3*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(8*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(15/2)) - (195*prms.J6p*prms.R1^6*z_n^2*(prms.u - 1)*(5*((prms.u + x_n)^2 + y_n^2 + z_n^2)^3 - 105*z_n^2*((prms.u + x_n)^2 + y_n^2 + z_n^2)^2 - 231*z_n^6 + 315*z_n^4*((prms.u + x_n)^2 + y_n^2 + z_n^2)))/(16*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(17/2)) + (35*prms.J2s*prms.R2^2*prms.u*z_n^2*((prms.u + x_n - 1)^2 + y_n^2 - 2*z_n^2))/(2*((prms.u + x_n - 1)^2 + y_n^2 + z_n^2)^(9/2)) + (9*prms.J4p*prms.R1^4*z_n*(48*z_n*((prms.u + x_n)^2 + y_n^2 + z_n^2) - 80*z_n^3)*(prms.u - 1))/(4*((prms.u + x_n)^2 + y_n^2 + z_n^2)^(11/2)); % dz_ndd/dz_n


end

